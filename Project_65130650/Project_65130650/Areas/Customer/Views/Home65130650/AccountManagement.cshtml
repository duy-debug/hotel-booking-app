@model Project_65130650.Models.NguoiDung
@{
    ViewBag.Title = "Thông tin tài khoản";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="max-w-5xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <a href="@Url.Action("Index", "Home65130650", new { area = "Customer" })" 
           class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-600 transition-all">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Cài đặt tài khoản</h1>
            <p class="text-gray-500 text-sm">Quản lý và cập nhật thông tin cá nhân của bạn</p>
        </div>
    </div>

    <!-- Thông báo nhanh -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-500 text-green-700 rounded shadow-sm">
            <i class="fas fa-check-circle mr-2"></i> @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded shadow-sm">
            <i class="fas fa-exclamation-circle mr-2"></i> @TempData["ErrorMessage"]
        </div>
    }

    <form method="post" action="@Url.Action("AccountManagement", "Home65130650", new { area = "Customer" })" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.maNguoiDung)

        <!-- Cột trái: Thông tin cơ bản -->
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-bold text-gray-800 mb-6 border-b pb-4 flex items-center">
                    <i class="fas fa-user-edit text-blue-500 mr-2"></i> Thông tin cá nhân
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Họ và tên <span class="text-red-500">*</span></label>
                        <input type="text" name="hoTen" value="@Model.hoTen" required
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" />
                    </div>

                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Email (Không thể thay đổi)</label>
                        <input type="email" name="email" value="@Model.email" readonly
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-200 bg-gray-50 text-gray-500 cursor-not-allowed" />
                    </div>

                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Số điện thoại</label>
                        <input type="text" name="soDienThoai" value="@Model.soDienThoai"
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" />
                    </div>

                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Ngày sinh</label>
                        <input type="date" name="ngaySinh" value="@(Model.ngaySinh.HasValue ? Model.ngaySinh.Value.ToString("yyyy-MM-dd") : "")"
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" />
                    </div>

                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Giới tính</label>
                        <div class="relative custom-select-container">
                            <input type="hidden" name="gioiTinh" id="hiddenGioiTinh" value="@Model.gioiTinh" />
                            <div class="w-full px-4 py-2.5 rounded-lg border border-gray-300 bg-white cursor-pointer flex items-center justify-between hover:border-blue-300 transition-all" id="customSelectToggle">
                                <span id="selectedLabel">@(string.IsNullOrEmpty(Model.gioiTinh) ? "Chọn giới tính" : Model.gioiTinh)</span>
                                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                            </div>
                            <div class="absolute left-0 right-0 mt-1 bg-white border border-gray-100 rounded-xl shadow-xl z-50 hidden overflow-hidden" id="customOptions">
                                <div class="px-4 py-2.5 hover:bg-blue-50 hover:text-blue-700 cursor-pointer transition-colors border-b border-gray-50" data-value="Nam">
                                    <i class="fas fa-mars mr-2 opacity-50"></i> Nam
                                </div>
                                <div class="px-4 py-2.5 hover:bg-pink-50 hover:text-pink-700 cursor-pointer transition-colors border-b border-gray-50" data-value="Nữ">
                                    <i class="fas fa-venus mr-2 opacity-50"></i> Nữ
                                </div>
                                <div class="px-4 py-2.5 hover:bg-gray-50 hover:text-gray-700 cursor-pointer transition-colors" data-value="Khác">
                                    <i class="fas fa-genderless mr-2 opacity-50"></i> Khác
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Địa chỉ</label>
                        <textarea name="diaChi" rows="2" 
                                  class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">@Model.diaChi</textarea>
                    </div>
                </div>
            </div>

            <!-- Bảo mật -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h2 class="text-lg font-bold text-gray-800 mb-6 border-b pb-4 flex items-center">
                    <i class="fas fa-shield-alt text-purple-500 mr-2"></i> Đổi mật khẩu
                </h2>
                <p class="text-xs text-amber-600 mb-4 bg-amber-50 p-2 rounded">Bỏ trống nếu không muốn thay đổi mật khẩu.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Mật khẩu mới</label>
                        <input type="password" name="NewPassword" placeholder="Nhập mật khẩu mới"
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" />
                    </div>
                    <div class="space-y-1">
                        <label class="text-sm font-medium text-gray-700">Xác nhận mật khẩu</label>
                        <input type="password" name="ConfirmPassword" placeholder="Nhập lại mật khẩu mới"
                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Cột phải: Tổng quan -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl shadow-lg p-6 text-white text-center">
                <div class="w-20 h-20 bg-white/20 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold backdrop-blur-sm border border-white/30">
                    @(Model.hoTen?.Substring(0, 1).ToUpper() ?? "U")
                </div>
                <h3 class="text-xl font-bold mb-1">@Model.hoTen</h3>
                <p class="text-blue-100 text-sm mb-4">ID: @Model.maNguoiDung</p>
                <div class="inline-block px-3 py-1 bg-white/10 rounded-full text-xs font-medium border border-white/20">
                    <i class="fas fa-crown text-yellow-300 mr-1"></i> @Model.vaiTro
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">Hoạt động</h4>
                <div class="space-y-4">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-gray-50 flex items-center justify-center text-gray-400">
                            <i class="fas fa-calendar-plus text-xs"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400">Ngày tham gia</p>
                            <p class="text-sm font-medium text-gray-700">@(Model.ngayTao?.ToString("dd/MM/yyyy") ?? "N/A")</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-gray-50 flex items-center justify-center text-gray-400">
                            <i class="fas fa-history text-xs"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400">Cập nhật cuối</p>
                            <p class="text-sm font-medium text-gray-700">@(Model.ngayCapNhat?.ToString("dd/MM/yyyy HH:mm") ?? "N/A")</p>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" 
                    class="w-full py-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 hover:shadow-xl transition-all flex items-center justify-center gap-2">
                <i class="fas fa-save shadow-sm"></i> CẬP NHẬT THÔNG TIN
            </button>
            <a href="@Url.Action("Index", "Home65130650", new { area = "Customer" })" 
               class="w-full py-3 bg-gray-100 text-gray-600 rounded-xl font-semibold flex items-center justify-center hover:bg-gray-200 transition-all">
                Hủy bỏ
            </a>
        </div>
    </form>
</div>

<style>
    /* Tắt đường viền đen mặc định của trình duyệt và ép lỗi chỉ hiện màu xanh */
    input:focus, 
    textarea:focus {
        outline: none !important;
        border-color: #3b82f6 !important; /* màu blue-500 */
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
    }

    /* Hiệu ứng hover cho các ô input và select custom */
    input:hover, 
    #customSelectToggle:hover, 
    textarea:hover {
        border-color: #93c5fd !important; /* màu blue-300 */
        background-color: #f8faff;
    }

    /* Trạng thái khi dropdown đang mở */
    .custom-select-container.active #customSelectToggle {
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
        background-color: #fff;
    }

    .custom-select-container.active #customOptions {
        display: block;
        animation: slideDown 0.2s ease-out;
    }

    /* Animation cho dropdown list */
    @@keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Xử lý Custom Dropdown Giới tính
            const $container = $('.custom-select-container');
            const $toggle = $('#customSelectToggle');
            const $options = $('#customOptions');
            const $hiddenInput = $('#hiddenGioiTinh');
            const $label = $('#selectedLabel');

            $toggle.on('click', function() {
                $container.toggleClass('active');
            });

            $('#customOptions div').on('click', function() {
                const val = $(this).data('value');
                const text = $(this).text().trim();
                
                $hiddenInput.val(val);
                $label.text(text);
                $container.removeClass('active');
            });

            // Click ra ngoài để đóng dropdown
            $(document).on('click', function(e) {
                if (!$container.is(e.target) && $container.has(e.target).length === 0) {
                    $container.removeClass('active');
                }
            });

            // Tự động ẩn thông báo sau 4 giây
            setTimeout(function() {
                $('.p-4.bg-green-50, .p-4.bg-red-50').fadeOut('slow');
            }, 4000);

            // Kiểm tra mật khẩu phía client
            $('form').on('submit', function(e) {
                var pass = $('input[name="NewPassword"]').val();
                var confirm = $('input[name="ConfirmPassword"]').val();
                
                if (pass !== "") {
                    // Regex kiểm tra độ mạnh mật khẩu
                    var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&])[A-Za-z\d@@$!%*?&]{8,}$/;
                    
                    if (!regex.test(pass)) {
                        alert('Mật khẩu bảo mật phải có: ít nhất 8 ký tự, 1 chữ hoa, 1 chữ thường, 1 số và 1 ký tự đặc biệt (@@$!%*?&)');
                        e.preventDefault();
                        return;
                    }

                    if (pass !== confirm) {
                        alert('Mật khẩu xác nhận không khớp. Vui lòng kiểm tra lại!');
                        e.preventDefault();
                    }
                }
            });
        });
    </script>
}
